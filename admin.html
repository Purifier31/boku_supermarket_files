<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boku Supermarket — Admin</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div><strong>Boku Supermarket</strong></div>
    <nav>
      <a href="index.html">Dashboard</a>
      <a href="scanner.html">Scanner</a>
      <a href="admin.html">Admin</a>
    </nav>
  </header>

  <main>
    <div class="card">
      <h2>Admin Panel</h2>
      <p>Login required to add products manually.</p>

      <!-- Login Box -->
      <div id="loginBox">
        <input type="password" id="adminPass" placeholder="Enter Admin Password" style="padding:8px;width:60%">
        <label>
          <input type="checkbox" id="togglePassword"> Show Password
        </label>
        <button id="loginBtn">Login</button>
        <div id="loginMsg" style="color:red;margin-top:8px"></div>
      </div>

      <!-- Admin Form -->
      <div id="adminArea" style="display:none;margin-top:12px">
        <h3>Add Product Manually</h3>
        <input id="pName" placeholder="Product Name" style="padding:8px;width:100%">
        <input id="pCode" placeholder="Barcode / Product Code" style="padding:8px;width:100%">
        <input id="pExpiry" type="date" style="padding:8px;width:100%">
        <select id="pStatus" style="padding:8px;width:100%">
          <option value="Valid">Valid</option>
          <option value="Expired">Expired</option>
        </select>
        <button id="addBtn">Add Product</button>
        <div id="adminResult" style="margin-top:8px"></div>
      </div>
    </div>
  </main>

  <!-- Firebase + Admin Script -->
  <script type="module">
    import { db } from './firebase.js';
    import { collection, addDoc } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js';

    document.addEventListener('DOMContentLoaded', () => {
      const ADMIN_PASSWORD = 'admin123';

      const passInput = document.getElementById('adminPass');
      const togglePass = document.getElementById('togglePassword');
      const loginBtn = document.getElementById('loginBtn');
      const loginBox = document.getElementById('loginBox');
      const adminArea = document.getElementById('adminArea');
      const loginMsg = document.getElementById('loginMsg');

      const pName = document.getElementById('pName');
      const pCode = document.getElementById('pCode');
      const pExpiry = document.getElementById('pExpiry');
      const pStatus = document.getElementById('pStatus');
      const addBtn = document.getElementById('addBtn');
      const adminResult = document.getElementById('adminResult');

      // Show/hide password
      togglePass.addEventListener('change', () => {
        passInput.type = togglePass.checked ? 'text' : 'password';
      });

      // Login
      loginBtn.addEventListener('click', () => {
        if (passInput.value.trim() === ADMIN_PASSWORD) {
          loginBox.style.display = 'none';
          adminArea.style.display = 'block';
          loginMsg.textContent = '';
          passInput.value = '';
        } else {
          loginMsg.textContent = 'Incorrect password.';
        }
      });

      // Press Enter to login
      passInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') loginBtn.click();
      });

      // Add product to Firestore
      addBtn.addEventListener('click', async () => {
        const name = pName.value.trim();
        const code = pCode.value.trim();
        const expiry = pExpiry.value;
        const status = pStatus.value;

        if (!name || !code || !expiry) {
          adminResult.style.color = 'red';
          adminResult.textContent = '⚠️ Please fill all fields.';
          return;
        }

        try {await addDoc(collection(db, 'products'), { name, code, expiry, status, addedAt: new Date().toISOString() });
          adminResult.style.color = 'green';
          adminResult.textContent = '✅ Product added successfully!';
          pName.value = '';
          pCode.value = '';
          pExpiry.value = '';
        } catch (err) {
          console.error(err);
          adminResult.style.color = 'red';
          adminResult.textContent = '❌ Error adding product.';
        }
      });
    });
  </script>
</body>
</html>