<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Boku Supermarket â€” Admin</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div><strong>Boku Supermarket</strong></div>
    <nav class="nav-links">
      <a href="index.html">Dashboard</a>
      <a href="scanner.html">Scanner</a>
      <a href="admin.html">Admin</a>
    </nav>
  </header>
  <main class="container">
    <div class="card">
      <h2>Admin Panel</h2>
      <p>Login required to add products manually.</p>
      <div id="loginBox">
        <label>Enter Admin Password:</label><br>
        <input type="password" id="adminPass" placeholder="Password" style="padding:8px;border-radius:6px;border:1px solid #ddd;width:60%">
        <button class="primary" onclick="doLogin()">Login</button>
        <div id="loginMsg" style="margin-top:10px;color:#c00"></div>
      </div>

      <div id="adminArea" style="display:none;margin-top:12px">
        <h3>Add Product Manually</h3>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-start">
          <input id="pName" placeholder="Product name" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd">
          <input id="pCode" placeholder="Barcode / Product code" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd">
          <input id="pExpiry" type="date" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd">
          <select id="pStatus" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd">
            <option value="Valid">Valid</option>
            <option value="Expired">Expired</option>
          </select>
          <button class="primary" onclick="addProduct()">Add Product</button>
          <div id="adminResult" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    import { db, fbCollection, fbAddDoc } from './firebase.js';
    const ADMIN_PASSWORD = 'admin123';
    const loginMsg = document.getElementById('loginMsg');
    const loginBox = document.getElementById('loginBox');
    const adminArea = document.getElementById('adminArea');
    const adminResult = document.getElementById('adminResult');

    function doLogin(){
      const p = document.getElementById('adminPass').value;
      if(p === ADMIN_PASSWORD){
        loginBox.style.display = 'none';
        adminArea.style.display = 'block';
        loginMsg.textContent = '';
      } else {
        loginMsg.textContent = 'Incorrect password.';
      }
    }

    async function addProduct(){
      const name = document.getElementById('pName').value.trim();
      const code = document.getElementById('pCode').value.trim();
      const expiry = document.getElementById('pExpiry').value;
      const status = document.getElementById('pStatus').value;
      if(!name || !code || !expiry){ adminResult.textContent = 'Please fill all fields.'; return; }
      try{
        await fbAddDoc(fbCollection(db,'products'), { name, code, expiry, status, addedAt: new Date().toISOString() });
        adminResult.style.color = 'green';
        adminResult.textContent = 'Product added successfully.';
        document.getElementById('pName').value = '';
        document.getElementById('pCode').value = '';
        document.getElementById('pExpiry').value = '';
      }catch(e){ console.error(e); adminResult.style.color = 'red'; adminResult.textContent = 'Error adding product.' }
    }
  </script>
</body>
</html>
